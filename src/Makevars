## C++ compiler flags. Include '.' directory to use bracket include notation
PKG_CPPFLAGS = -DANN_PERF -DPERF -I.

# Set order of source directories
SOURCES = $(wildcard ANN/*.cpp util/*.cpp brute_force/*.cpp bd_tree/*.cpp  kd_tree/*.cpp dual_tree/*.cpp dual_tree/*/*.cpp clustertree/*.cpp)

# Anything with a cpp extension is a source file
OBJECTS = $(SOURCES:.cpp=.o)

# Specify subdirectories to build static libraries for
SUBDIRS = ANN util brute_force bd_tree kd_tree dual_tree clustertree
SUBLIBS = $(SUBDIRS:=.a)

## All rule
all: $(SHLIB)

## For each object, build the sub libraries
$(SHLIB): $(OBJECTS) sublibraries


# Command to actually build the sources
sublibraries: subclean
	@for d in $(SUBDIRS); do \
	  (cd $${d} && CFLAGS="$(CFLAGS)" CXXFLAGS="$(CXXFLAGS)" $(MAKE) library) || exit 1; \
	done

# Clean top directory
clean: subclean
	@-rm -rf .libs _libs
	@-rm -f *.o $(SHLIB)

## Clean rule for sub directories
subclean:
	@-rm -f *.a
	@for d in $(SUBDIRS); do \
	  (cd $${d} && $(MAKE) clean) || exit 1; \
	done

