CXX_STD = CXX11
PKG_CPPFLAGS += -I$(realpath .) -std=c++11
## ^^ C++ compiler flags. Use c++11. Extra include allows the use of bracket #include notation
## For CRAN releases, use -pedantic and -Wall beforehand

## Import variables from R make configuration
MkInclude = $(R_HOME)/etc${R_ARCH}/Makeconf

## Source files
ANN_SRC = $(wildcard ANN/*.cpp ANN/**/*.cpp)
INT_SRC = $(wildcard *.cpp)

## Object files (exported to clean later)
ANN_OBJ := $(ANN_SRC:%.cpp=%.o)
INT_OBJ := $(INT_SRC:%.cpp=%.o)

## Phony targets to enable ordering the build process
.PHONY = all ANN INT

## Objects include: ANN library, Dual tree library, cluster tree files, and R interface files
OBJECTS = $(ANN_OBJ) $(INT_OBJ)

## Generate shared library form the R_interface
all: $(SHLIB)
$(SHLIB): INT

## ANN compilation
ANN: $(ANN_OBJ)
$(ANN_OBJ): %.o: %.cpp
	$(CC) $(ALL_CPPFLAGS) $(ALL_CFLAGS) -c $< -o $@

## R Interface compilation
INT: $(INT_OBJ) ANN
$(INT_OBJ): %.o: %.cpp
	$(CC) $(ALL_CPPFLAGS) $(ALL_CFLAGS) -c $< -o $@

## Clean rule
shlib-clean: clean
clean:
	@-rm -rf .libs _libs
	@-rm -f $(SHLIB)
	@-rm -f *.a
	@-rm -f ANN/*.o
	@-rm -f ANN/**/*.o
	@-rm -f *.o